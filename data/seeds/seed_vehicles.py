#!/usr/bin/env python3
"""Seed du referentiel vehicules -- Top 144+ modeles les plus vendus en France.

Script idempotent : ne cree pas de doublons si relance.
Usage : python data/seeds/seed_vehicles.py
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).resolve().parent.parent.parent))

from app import create_app  # noqa: E402
from app.extensions import db  # noqa: E402
from app.models.vehicle import Vehicle, VehicleSpec  # noqa: E402
from app.services.pipeline_tracker import track_pipeline  # noqa: E402

# Top 144+ modeles les plus vendus en France (ventes 2024-2025 + parc occasion)
VEHICLES = [
    # (marque, modele, generation, annee_debut, annee_fin)
    # --- Existants (20 originaux) ---
    ("Peugeot", "208", "II", 2019, 2025),
    ("Peugeot", "3008", "II", 2016, 2023),
    ("Peugeot", "308", "III", 2021, 2025),
    ("Peugeot", "2008", "II", 2019, 2025),
    ("Renault", "Clio V", "V", 2019, 2025),
    ("Renault", "Captur", "II", 2019, 2025),
    ("Renault", "Megane", "IV", 2015, 2023),
    ("Renault", "Scenic", "IV", 2016, 2022),
    ("Citroen", "C3", "III", 2016, 2025),
    ("Citroen", "C3 Aircross", "I", 2017, 2025),
    ("Citroen", "C5 Aircross", "I", 2018, 2025),
    ("Dacia", "Sandero", "III", 2020, 2025),
    ("Dacia", "Duster", "II", 2017, 2025),
    ("Volkswagen", "Golf", "VII/VIII", 2012, 2025),
    ("Volkswagen", "Polo", "VI", 2017, 2025),
    ("Toyota", "Yaris", "IV", 2020, 2025),
    ("Toyota", "C-HR", "I/II", 2016, 2025),
    ("Fiat", "500", "II", 2007, 2025),
    ("Ford", "Fiesta", "VII", 2017, 2023),
    ("BMW", "Serie 3", "G20", 2018, 2025),
    # --- 30 nouveaux modeles (Top 50 ventes 2025) ---
    ("Renault", "5 E-Tech", "I", 2024, 2025),
    ("Renault", "Symbioz", "I", 2024, 2025),
    ("Renault", "Austral", "I", 2022, 2025),
    ("Peugeot", "5008", "II", 2017, 2025),
    ("Ford", "Puma", "I", 2019, 2025),
    ("Dacia", "Bigster", "I", 2025, 2025),
    ("Citroen", "e-C3", "I", 2024, 2025),
    ("Toyota", "Yaris Cross", "I", 2021, 2025),
    ("Hyundai", "Tucson", "IV", 2020, 2025),
    ("Volkswagen", "Tiguan", "II", 2016, 2025),
    ("Opel", "Corsa", "F", 2019, 2025),
    ("Mini", "Cooper", "F56/F66", 2014, 2025),
    ("Volkswagen", "T-Roc", "I", 2017, 2025),
    ("Dacia", "Jogger", "I", 2022, 2025),
    ("Nissan", "Qashqai", "III", 2021, 2025),
    ("Volkswagen", "T-Cross", "I", 2018, 2025),
    ("Citroen", "C4", "III", 2020, 2025),
    ("BMW", "Serie 1", "F40", 2019, 2025),
    ("MG", "ZS", "I", 2020, 2025),
    ("Suzuki", "Swift", "IV", 2017, 2025),
    ("Hyundai", "Kona", "I/II", 2017, 2025),
    ("Ford", "Kuga", "III", 2019, 2025),
    ("Toyota", "Aygo X", "I", 2022, 2025),
    ("BMW", "X1", "U11", 2022, 2025),
    ("Skoda", "Fabia", "IV", 2021, 2025),
    ("MG", "3", "I", 2024, 2025),
    ("Mercedes", "GLA", "II", 2020, 2025),
    ("Nissan", "Juke", "II", 2019, 2025),
    ("Kia", "Sportage", "V", 2021, 2025),
    ("Audi", "A3", "8Y", 2020, 2025),
    ("Skoda", "Octavia", "IV", 2019, 2025),
    ("Mercedes", "Classe A", "W177", 2018, 2025),
    # --- Nouveaux modeles (revue marche FR 2024 top 100 immat.) ---
    ("Tesla", "Model Y", "I", 2021, 2025),
    ("Tesla", "Model 3", "I/II", 2019, 2025),
    ("Toyota", "Corolla", "XII", 2018, 2025),
    ("Toyota", "RAV4", "V", 2018, 2025),
    ("Seat", "Ibiza", "V", 2017, 2025),
    ("Seat", "Arona", "I", 2017, 2025),
    ("Cupra", "Formentor", "I", 2020, 2025),
    ("Dacia", "Spring", "I", 2021, 2025),
    ("Kia", "Niro", "II", 2022, 2025),
    ("Kia", "Picanto", "III", 2017, 2025),
    ("Opel", "Mokka", "II", 2020, 2025),
    ("Volkswagen", "ID.3", "I", 2020, 2025),
    ("Volkswagen", "Taigo", "I", 2021, 2025),
    ("Skoda", "Kamiq", "I", 2019, 2025),
    ("Peugeot", "408", "I", 2022, 2025),
    ("Renault", "Espace", "VI", 2023, 2025),
    ("Jeep", "Avenger", "I", 2022, 2025),
    ("Fiat", "600", "I", 2024, 2025),
    # --- Ajouts suite a demandes utilisateurs ---
    ("Mercedes", "GLC", "II", 2022, 2025),
    # Mercedes gamme complete (berlines + SUV + coupe)
    ("Mercedes", "Classe B", "W247", 2018, 2025),
    ("Mercedes", "Classe C", "W206", 2021, 2025),
    ("Mercedes", "Classe E", "W214", 2023, 2025),
    ("Mercedes", "CLA", "C118", 2019, 2025),
    ("Mercedes", "GLB", "X247", 2019, 2025),
    ("Mercedes", "GLE", "V167", 2019, 2025),
    # --- Utilitaires ---
    ("Ford", "Transit", "VI/VII", 2013, 2025),
    ("Ford", "Transit Custom", "I/II", 2012, 2025),
    ("Ford", "Transit Connect", "II/III", 2013, 2025),
    ("Ford", "Transit Courier", "I/II", 2014, 2025),
]

# Specs de base pour chaque modele (fuel, transmission, puissance)
# Format: (marque, modele, fuel_type, transmission, engine, power_hp,
#           reliability_rating, known_issues, expected_costs)
SPECS = [
    (
        "Peugeot",
        "208",
        "Essence",
        "Manuelle",
        "1.2 PureTech 100",
        100,
        4.0,
        "Courroie de distribution, turbo PureTech 1.2 (rappel)",
        "Courroie ~600 EUR, revision ~250 EUR",
    ),
    (
        "Peugeot",
        "208",
        "Diesel",
        "Manuelle",
        "1.5 BlueHDi 100",
        100,
        4.2,
        "FAP a surveiller sur trajets courts",
        "FAP ~800 EUR si encrasse",
    ),
    (
        "Peugeot",
        "3008",
        "Diesel",
        "Automatique",
        "1.5 BlueHDi 130 EAT8",
        130,
        3.8,
        "Boite EAT8 parfois hesitante, ecran tactile fragile",
        "Boite ~2000 EUR, ecran ~500 EUR",
    ),
    (
        "Peugeot",
        "3008",
        "Essence",
        "Automatique",
        "1.2 PureTech 130 EAT8",
        130,
        3.5,
        "Turbo PureTech, consommation essence elevee",
        "Turbo ~1200 EUR",
    ),
    (
        "Renault",
        "Clio V",
        "Essence",
        "Manuelle",
        "1.0 TCe 100",
        100,
        4.3,
        "Peu de problemes signales, modele fiable",
        "Revision ~200 EUR",
    ),
    (
        "Renault",
        "Clio V",
        "Hybride",
        "Automatique",
        "1.6 E-Tech 145",
        145,
        4.0,
        "Systeme hybride complexe, batterie a surveiller",
        "Batterie hybride ~1500 EUR",
    ),
    (
        "Renault",
        "Captur",
        "Essence",
        "Manuelle",
        "1.0 TCe 100",
        100,
        4.0,
        "Boite parfois dure a froid",
        "Embrayage ~800 EUR",
    ),
    (
        "Renault",
        "Megane",
        "Diesel",
        "Manuelle",
        "1.5 dCi 115",
        115,
        3.7,
        "Injecteurs, turbo, vanne EGR",
        "Injecteurs ~300 EUR/piece, turbo ~1500 EUR",
    ),
    (
        "Citroen",
        "C3",
        "Essence",
        "Manuelle",
        "1.2 PureTech 83",
        83,
        4.1,
        "Suspension ferme, PureTech fragile sur anciennes versions",
        "Suspension ~400 EUR",
    ),
    (
        "Citroen",
        "C3 Aircross",
        "Essence",
        "Manuelle",
        "1.2 PureTech 110",
        110,
        3.9,
        "Memes soucis PureTech que le C3",
        "Courroie ~600 EUR",
    ),
    (
        "Dacia",
        "Sandero",
        "Essence",
        "Manuelle",
        "1.0 TCe 90",
        90,
        4.5,
        "Tres fiable, peu de problemes. Finitions basiques.",
        "Revision ~150 EUR, tres peu de frais",
    ),
    (
        "Dacia",
        "Duster",
        "Diesel",
        "Manuelle",
        "1.5 dCi 115",
        115,
        4.2,
        "Robuste mais finitions fragiles (plastiques, sellerie)",
        "Revision ~200 EUR",
    ),
    (
        "Volkswagen",
        "Golf",
        "Diesel",
        "Automatique",
        "2.0 TDI 150 DSG",
        150,
        3.5,
        "Boite DSG (embrayage), AdBlue, electronique complexe",
        "Embrayage DSG ~2500 EUR, AdBlue ~100 EUR",
    ),
    (
        "Volkswagen",
        "Golf",
        "Essence",
        "Manuelle",
        "1.5 TSI 150",
        150,
        3.8,
        "Fiable en essence, turbo solide",
        "Revision ~300 EUR",
    ),
    (
        "Volkswagen",
        "Polo",
        "Essence",
        "Manuelle",
        "1.0 TSI 95",
        95,
        4.2,
        "Peu de problemes, bon rapport fiabilite",
        "Revision ~250 EUR",
    ),
    (
        "Toyota",
        "Yaris",
        "Hybride",
        "Automatique",
        "1.5 Hybrid 116",
        116,
        4.8,
        "Reference fiabilite, hybride eprouve, quasi aucun probleme",
        "Quasiment rien, revision ~200 EUR",
    ),
    (
        "Toyota",
        "C-HR",
        "Hybride",
        "Automatique",
        "1.8 Hybrid 122",
        122,
        4.6,
        "Tres fiable, systeme hybride Toyota mature",
        "Revision ~250 EUR",
    ),
    (
        "Fiat",
        "500",
        "Essence",
        "Manuelle",
        "1.2 69ch / 1.0 Hybrid 70",
        70,
        3.5,
        "Embrayage, demarreur, alternateur sur anciennes versions",
        "Embrayage ~700 EUR",
    ),
    (
        "Ford",
        "Fiesta",
        "Essence",
        "Manuelle",
        "1.0 EcoBoost 100",
        100,
        4.0,
        "Moteur EcoBoost fiable, suspension parfois bruyante",
        "Revision ~220 EUR",
    ),
    (
        "BMW",
        "Serie 3",
        "Diesel",
        "Automatique",
        "320d 190 BVA",
        190,
        3.6,
        "Chaine distribution, turbo, electronique couteuse",
        "Chaine ~1500 EUR, entretien ~500 EUR/an",
    ),
    # --- 30 nouveaux modeles ---
    # Renault 5 E-Tech
    (
        "Renault",
        "5 E-Tech",
        "Electrique",
        "Automatique",
        "Moteur electrique 150ch",
        150,
        4.0,
        "Modele recent, peu de recul. Batterie 52 kWh",
        "Entretien EV ~100 EUR/an",
    ),
    # Renault Symbioz
    (
        "Renault",
        "Symbioz",
        "Hybride",
        "Automatique",
        "1.6 E-Tech Full Hybrid 145",
        145,
        4.0,
        "Modele recent, base Captur. Systeme hybride Renault E-Tech",
        "Revision ~250 EUR",
    ),
    # Renault Austral
    (
        "Renault",
        "Austral",
        "Hybride",
        "Automatique",
        "1.2 E-Tech Full Hybrid 200",
        200,
        3.8,
        "Remplacant du Kadjar. Electronique complexe, ecran parfois lent",
        "Revision ~300 EUR",
    ),
    (
        "Renault",
        "Austral",
        "Essence",
        "Manuelle",
        "1.2 TCe 130 Mild Hybrid",
        130,
        3.9,
        "Micro-hybridation 48V, courroie a surveiller",
        "Revision ~250 EUR",
    ),
    # Peugeot 5008
    (
        "Peugeot",
        "5008",
        "Diesel",
        "Automatique",
        "1.5 BlueHDi 130 EAT8",
        130,
        3.7,
        "Boite EAT8 hesitante, FAP sur trajets courts, 7 places",
        "Boite ~2000 EUR, FAP ~800 EUR",
    ),
    (
        "Peugeot",
        "5008",
        "Essence",
        "Automatique",
        "1.2 PureTech 130 EAT8",
        130,
        3.5,
        "Turbo PureTech fragile (rappel constructeur), consommation elevee",
        "Turbo ~1200 EUR",
    ),
    # Ford Puma
    (
        "Ford",
        "Puma",
        "Essence",
        "Manuelle",
        "1.0 EcoBoost 125",
        125,
        4.1,
        "Moteur EcoBoost fiable, coffre Megabox pratique",
        "Revision ~220 EUR",
    ),
    (
        "Ford",
        "Puma",
        "Hybride",
        "Manuelle",
        "1.0 EcoBoost 125 mHEV",
        125,
        4.0,
        "Micro-hybridation 48V, bon compromis conso/puissance",
        "Revision ~230 EUR",
    ),
    # Dacia Bigster
    (
        "Dacia",
        "Bigster",
        "Hybride",
        "Automatique",
        "1.2 TCe 140 Mild Hybrid",
        140,
        4.0,
        "Modele tout neuf 2025, pas de recul fiabilite. Grand SUV familial",
        "Revision estimee ~200 EUR",
    ),
    # Citroen e-C3
    (
        "Citroen",
        "e-C3",
        "Electrique",
        "Automatique",
        "Moteur electrique 113ch",
        113,
        4.0,
        "EV abordable, batterie LFP 44 kWh, autonomie ~320 km WLTP",
        "Entretien EV ~100 EUR/an",
    ),
    # Toyota Yaris Cross
    (
        "Toyota",
        "Yaris Cross",
        "Hybride",
        "Automatique",
        "1.5 Hybrid 116",
        116,
        4.7,
        "Hybride Toyota mature, quasi aucun probleme. Coffre un peu juste",
        "Revision ~200 EUR",
    ),
    # Hyundai Tucson
    (
        "Hyundai",
        "Tucson",
        "Hybride",
        "Automatique",
        "1.6 T-GDi HEV 230",
        230,
        4.2,
        "Garantie 5 ans, systeme hybride fiable, electronique embarquee complete",
        "Revision ~280 EUR",
    ),
    (
        "Hyundai",
        "Tucson",
        "Diesel",
        "Manuelle",
        "1.6 CRDi 136",
        136,
        4.0,
        "Moteur diesel robuste, injecteurs a surveiller apres 100 000 km",
        "Injecteurs ~300 EUR/piece",
    ),
    # Volkswagen Tiguan
    (
        "Volkswagen",
        "Tiguan",
        "Diesel",
        "Automatique",
        "2.0 TDI 150 DSG",
        150,
        3.6,
        "Boite DSG double embrayage, AdBlue, electronique complexe VW",
        "Embrayage DSG ~2500 EUR",
    ),
    (
        "Volkswagen",
        "Tiguan",
        "Essence",
        "Manuelle",
        "1.5 TSI 150",
        150,
        3.9,
        "Moteur TSI fiable, consommation correcte pour un SUV",
        "Revision ~300 EUR",
    ),
    # Opel Corsa
    (
        "Opel",
        "Corsa",
        "Essence",
        "Manuelle",
        "1.2 Turbo 100",
        100,
        4.1,
        "Plateforme PSA (PureTech rebadge), memes soucis courroie",
        "Courroie ~600 EUR",
    ),
    (
        "Opel",
        "Corsa",
        "Electrique",
        "Automatique",
        "Moteur electrique 136ch",
        136,
        4.2,
        "Corsa-e, batterie 50 kWh, autonomie ~330 km WLTP",
        "Entretien EV ~100 EUR/an",
    ),
    # Mini Cooper
    (
        "Mini",
        "Cooper",
        "Essence",
        "Automatique",
        "1.5 136 DKG",
        136,
        3.5,
        "Boite double embrayage, electronique BMW, entretien premium",
        "Revision ~350 EUR, embrayage ~1800 EUR",
    ),
    (
        "Mini",
        "Cooper",
        "Electrique",
        "Automatique",
        "Moteur electrique 184ch",
        184,
        3.8,
        "Mini Cooper SE, batterie 54 kWh, autonomie ~300 km",
        "Entretien EV ~150 EUR/an",
    ),
    # Volkswagen T-Roc
    (
        "Volkswagen",
        "T-Roc",
        "Essence",
        "Automatique",
        "1.5 TSI 150 DSG",
        150,
        3.7,
        "Boite DSG, electronique VW. Bonne tenue de route",
        "Embrayage DSG ~2500 EUR, revision ~300 EUR",
    ),
    # Dacia Jogger
    (
        "Dacia",
        "Jogger",
        "Essence",
        "Manuelle",
        "1.0 TCe 110",
        110,
        4.3,
        "7 places, tres bon rapport espace/prix. Finitions basiques",
        "Revision ~180 EUR",
    ),
    (
        "Dacia",
        "Jogger",
        "Hybride",
        "Automatique",
        "1.6 Hybrid 140",
        140,
        4.0,
        "Systeme hybride Renault E-Tech, consommation basse",
        "Revision ~200 EUR",
    ),
    # Nissan Qashqai
    (
        "Nissan",
        "Qashqai",
        "Hybride",
        "Automatique",
        "1.3 DIG-T e-Power 190",
        190,
        3.9,
        "Systeme e-Power (moteur thermique = generateur), pas de boite classique",
        "Revision ~280 EUR",
    ),
    # Volkswagen T-Cross
    (
        "Volkswagen",
        "T-Cross",
        "Essence",
        "Manuelle",
        "1.0 TSI 95",
        95,
        4.2,
        "Petit SUV urbain, moteur 3 cylindres TSI fiable",
        "Revision ~250 EUR",
    ),
    # Citroen C4
    (
        "Citroen",
        "C4",
        "Diesel",
        "Automatique",
        "1.5 BlueHDi 130 EAT8",
        130,
        3.8,
        "Suspension progressive Citroen, FAP a surveiller",
        "FAP ~800 EUR, revision ~250 EUR",
    ),
    (
        "Citroen",
        "C4",
        "Electrique",
        "Automatique",
        "Moteur electrique 136ch",
        136,
        4.0,
        "e-C4, batterie 50 kWh, autonomie ~350 km WLTP",
        "Entretien EV ~100 EUR/an",
    ),
    # BMW Serie 1
    (
        "BMW",
        "Serie 1",
        "Essence",
        "Automatique",
        "118i 140 DKG",
        140,
        3.7,
        "Traction avant (F40+), boite DKG, electronique BMW premium",
        "Revision ~400 EUR, DKG ~2000 EUR",
    ),
    (
        "BMW",
        "Serie 1",
        "Diesel",
        "Automatique",
        "116d 116 BVA",
        116,
        3.8,
        "Diesel econome, chaine distribution, AdBlue",
        "Chaine ~1500 EUR, revision ~400 EUR",
    ),
    # MG ZS
    (
        "MG",
        "ZS",
        "Electrique",
        "Automatique",
        "Moteur electrique 177ch",
        177,
        3.5,
        "SUV EV chinois, batterie 72 kWh, autonomie ~440 km. Reseau SAV limite",
        "Batterie garantie 7 ans",
    ),
    (
        "MG",
        "ZS",
        "Essence",
        "Manuelle",
        "1.5 VTi 106",
        106,
        3.3,
        "Moteur basique, finitions en retrait, garantie 7 ans",
        "Revision ~150 EUR",
    ),
    # Suzuki Swift
    (
        "Suzuki",
        "Swift",
        "Hybride",
        "Manuelle",
        "1.2 Mild Hybrid 83",
        83,
        4.5,
        "Tres fiable, micro-hybridation, legere (moins de 1 tonne)",
        "Revision ~180 EUR",
    ),
    # Hyundai Kona
    (
        "Hyundai",
        "Kona",
        "Electrique",
        "Automatique",
        "Moteur electrique 218ch",
        218,
        4.3,
        "Batterie 65 kWh, autonomie ~490 km, garantie 5 ans",
        "Entretien EV ~120 EUR/an",
    ),
    (
        "Hyundai",
        "Kona",
        "Essence",
        "Automatique",
        "1.0 T-GDi 120 DCT",
        120,
        4.0,
        "Boite DCT double embrayage, compact et polyvalent",
        "Revision ~250 EUR",
    ),
    # Ford Kuga
    (
        "Ford",
        "Kuga",
        "Hybride",
        "Automatique",
        "2.5 Duratec FHEV 190",
        190,
        3.8,
        "Full hybrid, bon confort, consommation maitrisee",
        "Revision ~280 EUR",
    ),
    (
        "Ford",
        "Kuga",
        "Diesel",
        "Manuelle",
        "1.5 EcoBlue 120",
        120,
        3.9,
        "Diesel robuste, FAP a surveiller sur courts trajets",
        "FAP ~800 EUR, revision ~250 EUR",
    ),
    # Toyota Aygo X
    (
        "Toyota",
        "Aygo X",
        "Essence",
        "Manuelle",
        "1.0 VVT-i 72",
        72,
        4.5,
        "Micro-citadine tres fiable, moteur eprouve, peu de frais",
        "Revision ~150 EUR",
    ),
    # BMW X1
    (
        "BMW",
        "X1",
        "Essence",
        "Automatique",
        "sDrive18i 136 DKG",
        136,
        3.7,
        "SUV compact premium, boite DKG, electronique BMW",
        "Revision ~400 EUR, DKG ~2000 EUR",
    ),
    (
        "BMW",
        "X1",
        "Diesel",
        "Automatique",
        "sDrive18d 150 BVA",
        150,
        3.8,
        "Diesel econome, chaine distribution, AdBlue",
        "Chaine ~1500 EUR, revision ~400 EUR",
    ),
    # Skoda Fabia
    (
        "Skoda",
        "Fabia",
        "Essence",
        "Manuelle",
        "1.0 TSI 95",
        95,
        4.3,
        "Plateforme VW, fiabilite prouvee, rapport qualite/prix excellent",
        "Revision ~220 EUR",
    ),
    # MG 3
    (
        "MG",
        "3",
        "Hybride",
        "Automatique",
        "1.5 Hybrid 195",
        195,
        3.5,
        "Modele 2024 tres recent, hybride chinois. Reseau SAV a developper",
        "Garantie 7 ans, revision ~180 EUR",
    ),
    # Mercedes GLA
    (
        "Mercedes",
        "GLA",
        "Essence",
        "Automatique",
        "200 163 DCT",
        163,
        3.6,
        "SUV compact premium, boite DCT, electronique complexe MBUX",
        "Revision ~450 EUR, DCT ~2500 EUR",
    ),
    (
        "Mercedes",
        "GLA",
        "Diesel",
        "Automatique",
        "200d 150 DCT",
        150,
        3.7,
        "Diesel doux, consommation basse, AdBlue, chaine distrib",
        "Chaine ~1500 EUR, revision ~450 EUR",
    ),
    # Nissan Juke
    (
        "Nissan",
        "Juke",
        "Hybride",
        "Automatique",
        "1.6 Hybrid 143",
        143,
        3.9,
        "Systeme hybride fiable, design polarisant, coffre petit",
        "Revision ~260 EUR",
    ),
    # Kia Sportage
    (
        "Kia",
        "Sportage",
        "Hybride",
        "Automatique",
        "1.6 T-GDi HEV 230",
        230,
        4.2,
        "Garantie 7 ans, systeme hybride Hyundai/Kia, tres bien equipe",
        "Revision ~280 EUR",
    ),
    (
        "Kia",
        "Sportage",
        "Diesel",
        "Automatique",
        "1.6 CRDi 136 DCT",
        136,
        4.0,
        "Diesel robuste, boite DCT, garantie 7 ans constructeur",
        "Revision ~260 EUR",
    ),
    # Audi A3
    (
        "Audi",
        "A3",
        "Essence",
        "Automatique",
        "35 TFSI 150 S tronic",
        150,
        3.7,
        "Boite S tronic (DSG VW), electronique complexe, finition premium",
        "Embrayage S tronic ~2500 EUR, revision ~350 EUR",
    ),
    (
        "Audi",
        "A3",
        "Diesel",
        "Automatique",
        "30 TDI 116 S tronic",
        116,
        3.8,
        "Diesel econome, AdBlue, chaine distribution",
        "Chaine ~1500 EUR, revision ~350 EUR",
    ),
    # Skoda Octavia
    (
        "Skoda",
        "Octavia",
        "Diesel",
        "Automatique",
        "2.0 TDI 150 DSG",
        150,
        3.9,
        "Enormement d'espace, plateforme VW Golf. Boite DSG a surveiller",
        "Embrayage DSG ~2500 EUR, revision ~280 EUR",
    ),
    (
        "Skoda",
        "Octavia",
        "Essence",
        "Manuelle",
        "1.5 TSI 150",
        150,
        4.1,
        "Moteur TSI VW fiable, coffre geant (600L), excellent rapport qualite/prix",
        "Revision ~250 EUR",
    ),
    # Mercedes Classe A
    (
        "Mercedes",
        "Classe A",
        "Essence",
        "Automatique",
        "A200 163 DCT",
        163,
        3.5,
        "Compacte premium, boite DCT, electronique MBUX, entretien couteux",
        "Revision ~450 EUR, DCT ~2500 EUR",
    ),
    (
        "Mercedes",
        "Classe A",
        "Diesel",
        "Automatique",
        "A180d 116 DCT",
        116,
        3.6,
        "Diesel econome, chaine distrib, AdBlue, confort premium",
        "Chaine ~1500 EUR, revision ~450 EUR",
    ),
    # --- Specs nouveaux modeles (revue marche FR 2024) ---
    (
        "Tesla",
        "Model Y",
        "Electrique",
        "Automatique",
        "Long Range AWD 350 kW",
        456,
        4.0,
        "Ajustements carrosserie, bruits de caisse, ecran central unique",
        "Pas d'entretien moteur, pneus ~300 EUR/paire, batterie garantie 8 ans",
    ),
    (
        "Tesla",
        "Model 3",
        "Electrique",
        "Automatique",
        "Propulsion 208 kW",
        275,
        4.0,
        "Bruits de roulement, qualite de finition variable, peinture fragile",
        "Freins rares a changer (regen), pneus ~300 EUR/paire",
    ),
    (
        "Toyota",
        "Corolla",
        "Hybride",
        "Automatique",
        "1.8 Hybrid 140",
        140,
        4.5,
        "Fiabilite exemplaire, hybride auto-rechargeable, CVT parfois monotone",
        "Revision ~200 EUR, batterie hybride garantie 10 ans",
    ),
    (
        "Toyota",
        "RAV4",
        "Hybride",
        "Automatique",
        "2.5 Hybrid 218 AWD-i",
        218,
        4.3,
        "SUV familial fiable, consommation maitrisee, coffre genereux",
        "Revision ~250 EUR, pneus SUV ~200 EUR/unite",
    ),
    (
        "Seat",
        "Ibiza",
        "Essence",
        "Manuelle",
        "1.0 TSI 95",
        95,
        4.0,
        "Base VW Polo, chaine de distribution, electronique VW Group fiable",
        "Revision ~200 EUR, chaine ~800 EUR si necessaire",
    ),
    (
        "Cupra",
        "Formentor",
        "Essence",
        "Automatique",
        "1.5 TSI 150 DSG",
        150,
        3.8,
        "DSG a surveiller, suspension sport ferme, electronique complexe",
        "DSG vidange ~400 EUR, revision ~350 EUR",
    ),
    (
        "Dacia",
        "Spring",
        "Electrique",
        "Automatique",
        "Moteur 33 kW",
        45,
        3.8,
        "Petite autonomie (~230 km WLTP), finitions basiques, charge lente",
        "Entretien minimal ~100 EUR/an, batterie garantie 8 ans",
    ),
    (
        "Kia",
        "Niro",
        "Hybride",
        "Automatique",
        "1.6 GDi HEV 141",
        141,
        4.2,
        "Garantie 7 ans, hybride ou PHEV, finition soignee",
        "Revision ~250 EUR, garantie longue couvre la plupart des problemes",
    ),
    (
        "Opel",
        "Mokka",
        "Essence",
        "Automatique",
        "1.2 Turbo 130 EAT8",
        130,
        3.9,
        "Base PSA (comme 2008), PureTech rebadge, boite EAT8",
        "Courroie ~600 EUR, revision ~250 EUR",
    ),
    (
        "Volkswagen",
        "ID.3",
        "Electrique",
        "Automatique",
        "Pro Performance 150 kW",
        204,
        3.5,
        "Bugs logiciels frequents, qualite interieure decevante, mises a jour OTA",
        "Entretien minimal, pneus ~250 EUR/paire, batterie garantie 8 ans",
    ),
    (
        "Skoda",
        "Kamiq",
        "Essence",
        "Manuelle",
        "1.0 TSI 110",
        110,
        4.1,
        "SUV compact VW Group, chaine de distribution, bon rapport qualite-prix",
        "Revision ~200 EUR, chaine ~800 EUR",
    ),
    (
        "Peugeot",
        "408",
        "Hybride",
        "Automatique",
        "1.6 PHEV 225 e-EAT8",
        225,
        3.7,
        "Nouveau modele, PHEV complexe, i-Cockpit divise",
        "Revision PHEV ~350 EUR, batterie garantie 8 ans",
    ),
    (
        "Jeep",
        "Avenger",
        "Electrique",
        "Automatique",
        "Moteur 115 kW",
        156,
        3.8,
        "Base CMP Stellantis (comme e-2008), autonomie ~400 km WLTP",
        "Entretien minimal, pneus SUV ~180 EUR/unite",
    ),
    # Mercedes GLC
    (
        "Mercedes",
        "GLC",
        "Diesel",
        "Automatique",
        "220d 197 9G-Tronic",
        197,
        3.6,
        "Boite 9G-Tronic, electronique MBUX complexe, AdBlue, chaine distrib",
        "Revision ~500 EUR, chaine ~1500 EUR, AdBlue ~100 EUR",
    ),
    (
        "Mercedes",
        "GLC",
        "Essence",
        "Automatique",
        "200 204 9G-Tronic",
        204,
        3.5,
        "Turbo 4 cylindres, consommation elevee pour un SUV, entretien premium",
        "Revision ~500 EUR, turbo ~1500 EUR",
    ),
    # Mercedes Classe B
    (
        "Mercedes",
        "Classe B",
        "Essence",
        "Automatique",
        "B200 163 DCT",
        163,
        3.6,
        "Monospace compact premium, boite DCT, MBUX, espace aux jambes genereux",
        "Revision ~400 EUR, DCT ~2500 EUR",
    ),
    (
        "Mercedes",
        "Classe B",
        "Diesel",
        "Automatique",
        "B180d 116 DCT",
        116,
        3.7,
        "Diesel econome, AdBlue, chaine distrib, bon coffre familial",
        "Revision ~400 EUR, chaine ~1500 EUR",
    ),
    # Mercedes Classe C
    (
        "Mercedes",
        "Classe C",
        "Diesel",
        "Automatique",
        "220d 200 9G-Tronic",
        200,
        3.5,
        "Berline intermediaire, boite 9G-Tronic, MBUX, electronique complexe",
        "Revision ~500 EUR, 9G-Tronic ~2500 EUR",
    ),
    (
        "Mercedes",
        "Classe C",
        "Essence",
        "Automatique",
        "200 204 9G-Tronic",
        204,
        3.4,
        "Turbo 4 cylindres avec mild hybrid 48V, consommation maitrisee",
        "Revision ~500 EUR, turbo ~1500 EUR",
    ),
    # Mercedes Classe E
    (
        "Mercedes",
        "Classe E",
        "Diesel",
        "Automatique",
        "220d 197 9G-Tronic",
        197,
        3.5,
        "Berline executive, confort routier, MBUX avance, AdBlue, suspension air optionnelle",
        "Revision ~550 EUR, suspension air ~2000 EUR si equipee",
    ),
    (
        "Mercedes",
        "Classe E",
        "Hybride",
        "Automatique",
        "300e PHEV 313",
        313,
        3.4,
        "Plug-in hybride, batterie 25 kWh, autonomie EV ~100 km, electronique complexe",
        "Revision ~550 EUR, batterie garantie 8 ans",
    ),
    # Mercedes CLA
    (
        "Mercedes",
        "CLA",
        "Essence",
        "Automatique",
        "200 163 DCT",
        163,
        3.5,
        "Coupe 4 portes, base Classe A, boite DCT, design sportif, coffre limite",
        "Revision ~450 EUR, DCT ~2500 EUR",
    ),
    (
        "Mercedes",
        "CLA",
        "Diesel",
        "Automatique",
        "200d 150 DCT",
        150,
        3.6,
        "Diesel econome en coupe, AdBlue, chaine distrib, confort correct",
        "Revision ~450 EUR, chaine ~1500 EUR",
    ),
    # Mercedes GLB
    (
        "Mercedes",
        "GLB",
        "Essence",
        "Automatique",
        "200 163 DCT",
        163,
        3.6,
        "SUV familial compact 7 places optionnel, base Classe A, MBUX",
        "Revision ~450 EUR, DCT ~2500 EUR",
    ),
    (
        "Mercedes",
        "GLB",
        "Diesel",
        "Automatique",
        "200d 150 DCT",
        150,
        3.7,
        "Diesel familial, AdBlue, 7 places optionnel, bon coffre",
        "Revision ~450 EUR, chaine ~1500 EUR",
    ),
    # Mercedes GLE
    (
        "Mercedes",
        "GLE",
        "Diesel",
        "Automatique",
        "300d 272 9G-Tronic 4MATIC",
        272,
        3.5,
        "Grand SUV routier, 4x4, suspension air, MBUX, entretien premium couteux",
        "Revision ~600 EUR, suspension air ~2500 EUR, pneus ~300 EUR/unite",
    ),
    (
        "Mercedes",
        "GLE",
        "Hybride",
        "Automatique",
        "350de PHEV 320 4MATIC",
        320,
        3.4,
        "PHEV diesel, batterie 31 kWh, autonomie EV ~100 km, lourd (2.5t+)",
        "Revision ~600 EUR, batterie garantie 8 ans",
    ),
]


def seed():
    """Insere les vehicules et specs en base. Idempotent."""
    app = create_app()

    with app.app_context():
        db.create_all()

        with track_pipeline("referentiel_vehicules") as tracker:
            created_vehicles = 0
            created_specs = 0

            for brand, model, generation, year_start, year_end in VEHICLES:
                existing = Vehicle.query.filter_by(brand=brand, model=model).first()
                if existing:
                    print(f"  [skip] {brand} {model} existe deja")
                    continue

                v = Vehicle(
                    brand=brand,
                    model=model,
                    generation=generation,
                    year_start=year_start,
                    year_end=year_end,
                )
                db.session.add(v)
                db.session.flush()
                created_vehicles += 1
                print(f"  [+] {brand} {model} ({generation})")

            db.session.commit()

            # Ajout des specs
            for brand, model, fuel, trans, engine, power, reliability, issues, costs in SPECS:
                vehicle = Vehicle.query.filter_by(brand=brand, model=model).first()
                if not vehicle:
                    continue

                existing_spec = VehicleSpec.query.filter_by(
                    vehicle_id=vehicle.id, fuel_type=fuel, engine=engine
                ).first()
                if existing_spec:
                    continue

                spec = VehicleSpec(
                    vehicle_id=vehicle.id,
                    fuel_type=fuel,
                    transmission=trans,
                    engine=engine,
                    power_hp=power,
                    reliability_rating=reliability,
                    known_issues=issues,
                    expected_costs=costs,
                )
                db.session.add(spec)
                created_specs += 1

            db.session.commit()
            tracker.count = created_vehicles + created_specs

        total_v = Vehicle.query.count()
        total_s = VehicleSpec.query.count()
        print(f"\nResultat : {created_vehicles} vehicules crees, {created_specs} specs creees")
        print(f"Total en base : {total_v} vehicules, {total_s} specs")


if __name__ == "__main__":
    seed()
