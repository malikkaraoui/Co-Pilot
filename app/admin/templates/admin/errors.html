{% extends "admin/base.html" %}
{% block title %}Logs erreurs - Co-Pilot Admin{% endblock %}

{% block content %}
<h2 class="mb-4">Logs d'erreurs</h2>

<!-- Filtres -->
<div class="mb-3">
  <div class="btn-group">
    <a href="{{ url_for('admin.errors', level='ERROR') }}"
       class="btn btn-sm {{ 'btn-danger' if level_filter == 'ERROR' else 'btn-outline-danger' }}">
      ERROR
    </a>
    <a href="{{ url_for('admin.errors', level='WARNING') }}"
       class="btn btn-sm {{ 'btn-warning' if level_filter == 'WARNING' else 'btn-outline-warning' }}">
      WARNING
    </a>
    <a href="{{ url_for('admin.errors', level='ALL') }}"
       class="btn btn-sm {{ 'btn-secondary' if level_filter == 'ALL' else 'btn-outline-secondary' }}">
      TOUS
    </a>
  </div>
</div>

<!-- Table des logs -->
<div class="stat-card">
  {% if logs.items %}
    <table class="table table-sm table-hover mb-0">
      <thead>
        <tr>
          <th style="width:140px">Date</th>
          <th style="width:80px">Niveau</th>
          <th style="width:150px">Module</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs.items %}
        <tr>
          <td class="text-muted" style="font-size:12px">
            {{ (log.created_at|localtime).strftime('%d/%m %H:%M:%S') if log.created_at else '-' }}
          </td>
          <td>
            {% if log.level == 'ERROR' %}
              <span class="badge bg-danger">ERROR</span>
            {% elif log.level == 'WARNING' %}
              <span class="badge bg-warning text-dark">WARNING</span>
            {% else %}
              <span class="badge bg-secondary">{{ log.level }}</span>
            {% endif %}
          </td>
          <td style="font-size:12px">{{ log.module or '-' }}</td>
          <td style="font-size:13px">{{ log.message }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination -->
    {% if logs.pages > 1 %}
      <nav class="mt-3">
        <ul class="pagination pagination-sm justify-content-center mb-0">
          {% for p in logs.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if p %}
              <li class="page-item {{ 'active' if p == logs.page else '' }}">
                <a class="page-link" href="{{ url_for('admin.errors', level=level_filter, page=p) }}">{{ p }}</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
          {% endfor %}
        </ul>
      </nav>
    {% endif %}

  {% else %}
    <p class="text-muted text-center py-4">Aucun log {{ level_filter }} pour le moment.</p>
  {% endif %}
</div>
{% endblock %}
